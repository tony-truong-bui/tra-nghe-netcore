@model TraNgheCore.Models.CreateRoleViewModel
@{
    ViewBag.Title = "Create";
    Layout = "_Layout";
}

<h2>Create</h2>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    <div class="form-group">
        @Html.LabelFor(m => m.RoleName, htmlAttributes: new { @class = "control-label" })
        @Html.TextBoxFor(m => m.RoleName, new { @class = "form-control" })
        @Html.ValidationMessageFor(m => m.RoleName, "", new { @class = "text-danger" })

    </div>
    <div class="form-group">
        <div class="col-md-offset-2 col-md-10">
            <input type="submit" value="Add Role" class="btn btn-primary" />
        </div>
    </div>
}

@if (ViewBag.Roles != null && ViewBag.Roles.Any())
{
    <table>
        <thead>
            <tr>
                <th>Role Name</th>
                <th>Actions</th>
            </tr>
        <tbody>
            @foreach (var role in ViewBag.Roles)
            {
                <tr class=role-row-@role.Id>
                    <td>
                        @role.Id
                    </td>
                    <td>
                        <input id="name-input-@role.Id" class="form-control" type="text" value="@role.Name" />
                    </td>
                    <td>
                        <button class="btn btn-danger btn-sm delete-role" data-id="@role.Id">Delete</button>
                        <button class="btn btn-primary btn-sm edit-role" data-id="@role.Id">Update</button>

                    </td>
                </tr>
            }

        </tbody>

    </table>
}

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(function () {
            $('.delete-role').click(function (e) {
                e.preventDefault();
                var roleId = $(this).data('id');
                if (confirm('Are you sure you want to delete this role?')) {
                    $.ajax({
                        url: '@Url.Action("AjaxDelete", "Role")',
                        type: 'POST',
                        data: { id: roleId },
                        success: function (result) {
                            if (result.success) {
                                $('.role-row-' + roleId).remove();
                                alert('Role deleted successfully.');
                            } else {
                                alert('Error deleting role: ' + result.message);
                            }
                        },
                        error: function () {
                            alert('An error occurred while deleting the role.');
                        }
                    });
                }
            });
            $('.edit-role').click(function (e) {
                e.preventDefault();
                var roleId = $(this).data('id');
                var roleName = $('name-input-' + roleId).val();
                // Logic for editing the role can be added here
                if (confirm('Are you sure you want to edit this role?')) {
                    $.ajax({
                        url: '@Url.Action("AjaxUpdate", "Role")',
                        type: 'GET',
                        data: { id: roleId, name: roleName },
                        success: function (result) {
                            if (result.success) {
                                alert('Role data retrieved successfully for editing.');
                            } else {
                                alert('Error retrieving role data: ' + result.message);
                            }
                        },
                        error: function () {
                            alert('An error occurred while retrieving the role data.');
                        }
                    });
                }
            });
        });
    </script>




}